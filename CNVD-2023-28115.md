照着别人的教程复现了蛮多漏洞的，这次自己来对一个新的做复现，看看能不能行。



漏洞情报：https://www.cnvd.org.cn/flaw/show/CNVD-2023-28115

D-Link DIR-3040是中国友讯（D-Link）公司的一个路由器。提供连接网络的功能。

D-Link DIR-3040存在命令注入漏洞，该漏洞源于SetTriggerLEDBlink函数未能正确过滤构造命令特殊字符、命令等，攻击者可利用该漏洞导致任意命令执行。



找固件，下固件。碰到第一个问题，固件加密。

试了试Github上大神对D-Link的解密脚本，失败了。看样子是在大神破解后D-Link换了一些加密参数（因为还能识别一些密钥出来）

于是下低版本，解密成功。随后放到binwalk里解压，grep -Rnl找SetTriggerLEDBlink参数，发现位于/bin/prog.cgi与/bin/prog-cgi中。

拉出来放到IDA里看，发现顺着这个参数找只能找到这个函数：

![参数函数](F:\XDGLearning\PPTCollect\Replay\pic\参数函数.png)



也许这里是漏洞点，因为nptr确实可以被构造参数。atoi有被绕过的参数，但溢出不知道能不能触发gpio设置的相关问题。

因为不太确定，所以顺着twsystem这个函数往下审了一些函数，其它地方的参数都是本地生成的字符，Web上触发不到。



然后就是qemu挂程序开Web端口，用boofuzz做下测试看看能不能触发。但目前qemu执行prog.cgi遇到了链接库的一些问题，现在正在解决中。